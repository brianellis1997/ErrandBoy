<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GroupChat - Demo Control Panel</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#3B82F6',
                        secondary: '#64748B',
                    }
                }
            }
        }
    </script>
    <link rel="stylesheet" href="/static/css/styles.css">
    <style>
        .demo-control-panel {
            @apply fixed top-4 right-4 bg-white rounded-lg shadow-lg p-4 z-50 max-w-sm;
        }
        .demo-overlay {
            @apply fixed inset-0 bg-black bg-opacity-50 z-40 flex items-center justify-center;
        }
        .scenario-card {
            @apply border border-gray-200 rounded-lg p-4 cursor-pointer hover:bg-blue-50 hover:border-blue-300 transition-colors;
        }
        .scenario-card.selected {
            @apply bg-blue-50 border-blue-500 ring-2 ring-blue-200;
        }
        .status-badge {
            @apply inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium;
        }
        .status-badge.idle { @apply bg-gray-100 text-gray-800; }
        .status-badge.running { @apply bg-blue-100 text-blue-800; }
        .status-badge.paused { @apply bg-yellow-100 text-yellow-800; }
        .status-badge.completed { @apply bg-green-100 text-green-800; }
        .status-badge.error { @apply bg-red-100 text-red-800; }
        
        .progress-bar {
            @apply bg-blue-500 h-2 rounded-full transition-all duration-500 ease-out;
        }
        
        .connection-status {
            @apply text-xs font-medium;
        }
        .status-connected { @apply text-green-600; }
        .status-disconnected { @apply text-red-600; }
        
        .multi-screen-layout {
            display: grid;
            grid-template-columns: 1fr 1fr;
            grid-template-rows: 1fr 1fr;
            gap: 20px;
            height: 100vh;
            padding: 20px;
        }
        
        .screen-frame {
            @apply border-2 border-gray-300 rounded-lg overflow-hidden bg-white;
        }
        
        .screen-header {
            @apply bg-gray-100 px-4 py-2 border-b border-gray-300 font-medium text-sm;
        }
        
        .screen-content {
            @apply h-full overflow-hidden;
        }
    </style>
</head>
<body class="bg-gray-50">
    <!-- Demo Control Panel (Fixed Position) -->
    <div id="demoControlPanel" class="demo-control-panel hidden">
        <div class="flex justify-between items-center mb-4">
            <h3 class="text-lg font-semibold text-gray-900">Demo Control</h3>
            <div class="flex items-center space-x-2">
                <span id="demo-connection-status" class="connection-status">Connecting...</span>
                <button id="closeDemoPanel" class="text-gray-400 hover:text-gray-600">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                    </svg>
                </button>
            </div>
        </div>
        
        <!-- Demo Status -->
        <div class="mb-4">
            <div class="flex justify-between items-center mb-2">
                <span class="text-sm font-medium text-gray-700">Status:</span>
                <span id="demo-status" class="status-badge idle">Idle</span>
            </div>
            <div class="mb-2">
                <div class="flex justify-between text-sm text-gray-600 mb-1">
                    <span id="demo-stage">Ready</span>
                    <span id="demo-progress-percent">0%</span>
                </div>
                <div class="w-full bg-gray-200 rounded-full h-2">
                    <div id="demo-progress-bar" class="progress-bar" style="width: 0%"></div>
                </div>
            </div>
            <div class="grid grid-cols-3 gap-2 text-xs text-center">
                <div>
                    <div class="font-medium text-gray-900" id="experts-contacted">0</div>
                    <div class="text-gray-500">Experts</div>
                </div>
                <div>
                    <div class="font-medium text-gray-900" id="contributions-received">0</div>
                    <div class="text-gray-500">Responses</div>
                </div>
                <div>
                    <div class="font-medium text-gray-900" id="elapsed-time">0:00</div>
                    <div class="text-gray-500">Time</div>
                </div>
            </div>
        </div>
        
        <!-- Demo Controls -->
        <div class="space-y-2 mb-4">
            <button id="startDemoBtn" class="demo-control-btn w-full bg-green-500 hover:bg-green-600 text-white font-medium py-2 px-4 rounded-md transition-colors" data-action="start">
                Start Demo
            </button>
            <div class="grid grid-cols-2 gap-2">
                <button id="pauseDemoBtn" class="demo-control-btn bg-yellow-500 hover:bg-yellow-600 text-white font-medium py-2 px-4 rounded-md transition-colors disabled:opacity-50" data-action="pause" disabled>
                    Pause
                </button>
                <button id="resumeDemoBtn" class="demo-control-btn bg-blue-500 hover:bg-blue-600 text-white font-medium py-2 px-4 rounded-md transition-colors disabled:opacity-50" data-action="resume" disabled>
                    Resume
                </button>
            </div>
            <button id="resetDemoBtn" class="demo-control-btn w-full bg-red-500 hover:bg-red-600 text-white font-medium py-2 px-4 rounded-md transition-colors" data-action="reset">
                Reset Demo
            </button>
        </div>
        
        <!-- Mode Selection -->
        <div class="mb-4">
            <label class="block text-sm font-medium text-gray-700 mb-2">Demo Mode</label>
            <select id="demoModeSelect" class="w-full border border-gray-300 rounded-md px-3 py-2 text-sm">
                <option value="fast">Fast (10x speed)</option>
                <option value="realistic" selected>Realistic timing</option>
                <option value="manual">Manual control</option>
            </select>
        </div>
        
        <!-- Multi-Screen Controls -->
        <div class="border-t pt-4">
            <button id="multiScreenToggle" class="w-full bg-purple-500 hover:bg-purple-600 text-white font-medium py-2 px-4 rounded-md transition-colors">
                Multi-Screen View
            </button>
        </div>
    </div>
    
    <!-- Scenario Selection Overlay -->
    <div id="scenarioOverlay" class="demo-overlay hidden">
        <div class="bg-white rounded-lg shadow-xl p-6 max-w-2xl w-full mx-4 max-h-96 overflow-y-auto">
            <div class="flex justify-between items-center mb-6">
                <h2 class="text-xl font-semibold text-gray-900">Select Demo Scenario</h2>
                <button id="closeScenarioOverlay" class="text-gray-400 hover:text-gray-600">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                    </svg>
                </button>
            </div>
            
            <div id="scenariosList" class="space-y-4">
                <!-- Scenarios will be loaded here -->
            </div>
            
            <div class="mt-6 flex justify-end space-x-3">
                <button id="cancelScenarioSelection" class="bg-gray-300 hover:bg-gray-400 text-gray-800 font-medium py-2 px-4 rounded-md transition-colors">
                    Cancel
                </button>
                <button id="confirmScenarioSelection" class="bg-primary hover:bg-blue-700 text-white font-medium py-2 px-4 rounded-md transition-colors disabled:opacity-50" disabled>
                    Start Selected Demo
                </button>
            </div>
        </div>
    </div>
    
    <!-- Multi-Screen Layout -->
    <div id="multiScreenLayout" class="multi-screen-layout hidden">
        <div class="screen-frame">
            <div class="screen-header">User Interface</div>
            <div class="screen-content">
                <iframe src="/" class="w-full h-full border-none"></iframe>
            </div>
        </div>
        
        <div class="screen-frame">
            <div class="screen-header">Expert Interface</div>
            <div class="screen-content">
                <iframe src="/expert" class="w-full h-full border-none"></iframe>
            </div>
        </div>
        
        <div class="screen-frame">
            <div class="screen-header">Admin Dashboard</div>
            <div class="screen-content">
                <iframe src="/admin" class="w-full h-full border-none"></iframe>
            </div>
        </div>
        
        <div class="screen-frame">
            <div class="screen-header">Answer Display</div>
            <div class="screen-content">
                <div id="answerPreview" class="p-4 h-full overflow-auto">
                    <p class="text-gray-500 text-center">Answer will appear here when demo completes</p>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Main Content (Single Screen Mode) -->
    <div id="mainContent" class="min-h-screen">
        <div class="container mx-auto px-4 py-8 max-w-4xl">
            <!-- Header -->
            <div class="mb-8">
                <div class="flex justify-between items-center">
                    <div>
                        <h1 class="text-3xl font-bold text-gray-900 mb-2">GroupChat Demo Control</h1>
                        <p class="text-gray-600">Orchestrate end-to-end demonstrations of the GroupChat system</p>
                    </div>
                    <button id="showDemoPanel" class="bg-primary hover:bg-blue-700 text-white px-4 py-2 rounded-md transition-colors">
                        Show Control Panel
                    </button>
                </div>
            </div>
            
            <!-- Quick Start Card -->
            <div class="bg-white rounded-lg shadow-lg p-6 mb-6">
                <h2 class="text-xl font-semibold text-gray-900 mb-4">Quick Start Demo</h2>
                <p class="text-gray-600 mb-4">Launch a complete demonstration showcasing the GroupChat value proposition from question submission to expert responses to final answer delivery.</p>
                
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                    <div class="scenario-card" data-scenario="tech-scaling">
                        <h3 class="font-medium text-gray-900 mb-2">Technical Question</h3>
                        <p class="text-sm text-gray-600">PostgreSQL scaling best practices with database experts</p>
                        <div class="mt-2 text-xs text-gray-500">3 experts • ~4 min</div>
                    </div>
                    
                    <div class="scenario-card" data-scenario="startup-pmf">
                        <h3 class="font-medium text-gray-900 mb-2">Business Strategy</h3>
                        <p class="text-sm text-gray-600">Startup product-market fit with industry experts</p>
                        <div class="mt-2 text-xs text-gray-500">3 experts • ~5 min</div>
                    </div>
                    
                    <div class="scenario-card" data-scenario="remote-collaboration">
                        <h3 class="font-medium text-gray-900 mb-2">Creative Problem</h3>
                        <p class="text-sm text-gray-600">Remote team collaboration with UX and leadership experts</p>
                        <div class="mt-2 text-xs text-gray-500">3 experts • ~4 min</div>
                    </div>
                </div>
            </div>
            
            <!-- Demo Features -->
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <div class="bg-white rounded-lg shadow-lg p-6">
                    <h3 class="text-lg font-semibold text-gray-900 mb-3">Demo Features</h3>
                    <ul class="space-y-2 text-sm text-gray-600">
                        <li class="flex items-center">
                            <svg class="w-4 h-4 text-green-500 mr-2" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"></path>
                            </svg>
                            End-to-end workflow demonstration
                        </li>
                        <li class="flex items-center">
                            <svg class="w-4 h-4 text-green-500 mr-2" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"></path>
                            </svg>
                            Multi-screen coordination
                        </li>
                        <li class="flex items-center">
                            <svg class="w-4 h-4 text-green-500 mr-2" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"></path>
                            </svg>
                            Real-time progress tracking
                        </li>
                        <li class="flex items-center">
                            <svg class="w-4 h-4 text-green-500 mr-2" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"></path>
                            </svg>
                            Realistic expert responses
                        </li>
                        <li class="flex items-center">
                            <svg class="w-4 h-4 text-green-500 mr-2" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"></path>
                            </svg>
                            Answer synthesis with citations
                        </li>
                        <li class="flex items-center">
                            <svg class="w-4 h-4 text-green-500 mr-2" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"></path>
                            </svg>
                            Payment distribution visualization
                        </li>
                    </ul>
                </div>
                
                <div class="bg-white rounded-lg shadow-lg p-6">
                    <h3 class="text-lg font-semibold text-gray-900 mb-3">Demo Controls</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-sm text-gray-600">Fast Mode</span>
                            <span class="text-xs text-gray-500">10x faster for quick presentations</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-sm text-gray-600">Realistic Mode</span>
                            <span class="text-xs text-gray-500">Production-like timing</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-sm text-gray-600">Pause/Resume</span>
                            <span class="text-xs text-gray-500">Full demo control</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-sm text-gray-600">Reset</span>
                            <span class="text-xs text-gray-500">Clean demo environment</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <script src="/static/js/api.js"></script>
    <script src="/static/js/demo.js"></script>
    <script>
        // Demo Control Panel Logic
        let selectedScenario = null;
        
        document.addEventListener('DOMContentLoaded', () => {
            initializeDemoControls();
            loadAvailableScenarios();
        });
        
        function initializeDemoControls() {
            // Show/hide control panel
            document.getElementById('showDemoPanel').addEventListener('click', () => {
                document.getElementById('demoControlPanel').classList.remove('hidden');
            });
            
            document.getElementById('closeDemoPanel').addEventListener('click', () => {
                document.getElementById('demoControlPanel').classList.add('hidden');
            });
            
            // Demo controls
            document.getElementById('startDemoBtn').addEventListener('click', showScenarioSelection);
            
            document.getElementById('pauseDemoBtn').addEventListener('click', async () => {
                try {
                    await window.demoController.controlDemo('pause');
                } catch (error) {
                    console.error('Failed to pause demo:', error);
                }
            });
            
            document.getElementById('resumeDemoBtn').addEventListener('click', async () => {
                try {
                    await window.demoController.controlDemo('resume');
                } catch (error) {
                    console.error('Failed to resume demo:', error);
                }
            });
            
            document.getElementById('resetDemoBtn').addEventListener('click', async () => {
                try {
                    await window.demoController.controlDemo('reset');
                    resetDemoControls();
                } catch (error) {
                    console.error('Failed to reset demo:', error);
                }
            });
            
            // Multi-screen toggle
            document.getElementById('multiScreenToggle').addEventListener('click', toggleMultiScreen);
            
            // Scenario selection
            document.getElementById('closeScenarioOverlay').addEventListener('click', hideScenarioSelection);
            document.getElementById('cancelScenarioSelection').addEventListener('click', hideScenarioSelection);
            document.getElementById('confirmScenarioSelection').addEventListener('click', startSelectedDemo);
            
            // Scenario card selection
            document.addEventListener('click', (e) => {
                if (e.target.closest('.scenario-card')) {
                    selectScenario(e.target.closest('.scenario-card'));
                }
            });
            
            // Listen to demo progress events
            document.addEventListener('demoProgress', (e) => {
                updateDemoControls(e.detail);
            });
        }
        
        function showScenarioSelection() {
            document.getElementById('scenarioOverlay').classList.remove('hidden');
        }
        
        function hideScenarioSelection() {
            document.getElementById('scenarioOverlay').classList.add('hidden');
            selectedScenario = null;
            document.querySelectorAll('.scenario-card').forEach(card => {
                card.classList.remove('selected');
            });
            document.getElementById('confirmScenarioSelection').disabled = true;
        }
        
        function selectScenario(card) {
            // Remove selection from all cards
            document.querySelectorAll('.scenario-card').forEach(c => c.classList.remove('selected'));
            
            // Select this card
            card.classList.add('selected');
            selectedScenario = card.dataset.scenario;
            
            document.getElementById('confirmScenarioSelection').disabled = false;
        }
        
        async function startSelectedDemo() {
            if (!selectedScenario) return;
            
            try {
                const mode = document.getElementById('demoModeSelect').value;
                await window.demoController.startDemo(selectedScenario, mode);
                
                hideScenarioSelection();
                updateDemoControlButtons('running');
                
            } catch (error) {
                console.error('Failed to start demo:', error);
                alert('Failed to start demo: ' + error.message);
            }
        }
        
        function updateDemoControlButtons(status) {
            const startBtn = document.getElementById('startDemoBtn');
            const pauseBtn = document.getElementById('pauseDemoBtn');
            const resumeBtn = document.getElementById('resumeDemoBtn');
            const resetBtn = document.getElementById('resetDemoBtn');
            
            if (status === 'running') {
                startBtn.disabled = true;
                pauseBtn.disabled = false;
                resumeBtn.disabled = true;
            } else if (status === 'paused') {
                startBtn.disabled = true;
                pauseBtn.disabled = true;
                resumeBtn.disabled = false;
            } else if (status === 'completed' || status === 'error' || status === 'idle') {
                startBtn.disabled = false;
                pauseBtn.disabled = true;
                resumeBtn.disabled = true;
            }
        }
        
        function resetDemoControls() {
            updateDemoControlButtons('idle');
            
            // Reset progress display
            document.getElementById('demo-progress-bar').style.width = '0%';
            document.getElementById('demo-progress-percent').textContent = '0%';
            document.getElementById('demo-stage').textContent = 'Ready';
            document.getElementById('experts-contacted').textContent = '0';
            document.getElementById('contributions-received').textContent = '0';
            document.getElementById('elapsed-time').textContent = '0:00';
        }
        
        function updateDemoControls(detail) {
            updateDemoControlButtons(detail.status?.status || 'idle');
        }
        
        function toggleMultiScreen() {
            const multiScreen = document.getElementById('multiScreenLayout');
            const mainContent = document.getElementById('mainContent');
            
            if (multiScreen.classList.contains('hidden')) {
                multiScreen.classList.remove('hidden');
                mainContent.classList.add('hidden');
                document.getElementById('multiScreenToggle').textContent = 'Single Screen View';
            } else {
                multiScreen.classList.add('hidden');
                mainContent.classList.remove('hidden');
                document.getElementById('multiScreenToggle').textContent = 'Multi-Screen View';
            }
        }
        
        async function loadAvailableScenarios() {
            try {
                const scenarios = await window.demoController.getScenarios();
                const scenariosList = document.getElementById('scenariosList');
                
                scenariosList.innerHTML = scenarios.map(scenario => `
                    <div class="scenario-card" data-scenario="${scenario.id}">
                        <h3 class="font-medium text-gray-900 mb-2">${scenario.title}</h3>
                        <p class="text-sm text-gray-600 mb-3">${scenario.description}</p>
                        <div class="flex justify-between text-xs text-gray-500">
                            <span>${scenario.expert_count} experts</span>
                            <span>~${Math.ceil(scenario.estimated_duration / 60)} min</span>
                        </div>
                    </div>
                `).join('');
                
            } catch (error) {
                console.error('Failed to load scenarios:', error);
            }
        }
    </script>
</body>
</html>